html(lang='en')
  include ../components/stage_header.pug
  body.bg-light
    .container.prelimdocs
      include ../components/stage_navbar.pug
      form(method='post', enctype="multipart/form-data")
        include ../components/buttons.pug
        .row.motorinfo
          .col-md-4.order-md-2.mb-4#closepane.show
            h4.d-flex.justify-content-between.align-items-center.mb-3
              span.text-muted Motor Group Pane
              //- var smcount =  motorObjOncheckup.submotors
              //span.badge.badge-secondary.badge-pill.motorcount #{smcount.length+1}
            ul.list-group.mb-3.motorpane
                li.list-group-item.d-flex.justify-content-between.lh-condensed(data-toggle='collapse' data-target='#collapseOne' aria-expanded='false' aria-controls='collapseOne')
                  div
                    h6.my-0 #{motordetails.notstarted[0].motorType} - #{oncheckup.power}
                    small.text-muted Motor/TAG ID: #{motordetails.notstarted[0].tagID}

          .col-md-8.order-md-1.motorcol
            h4.mb-3 Motor Details
            form
              #accordionExample.accordion
                .card
                  #headingOne.card-header.mainmotor
                    h2.mb-0
                      button.btn.btn-link(type='button' data-toggle='collapse' data-target='#collapseOne' aria-expanded='true' aria-controls='collapseOne')
                        | Main Motor
                    .closepane
                      input.btn.btn-primary(type='button' name='closepane' value='Close Pane' data-toggle="collapse" data-target="#closepane" aria-expanded="true" aria-controls="closepane")
                  #collapseOne.collapse.show(aria-labelledby='headingOne' data-parent='#accordionExample')
                    .card-body
                      .row
                        .col-md-6.mb-3  
                          label(for='voltage') Generate Sales Invoice
                          input.form-control.btn-primary.btn(type='button' name='genSI' placeholder='' required='' value='Generate')
                        
                        .col-md-6.mb-3.genSI 
                      .row
                        .col-md-6.mb-3  
                          label(for='voltage') SI No.
                          input.form-control(type='text' name='sino' placeholder='' required='')
                      .row 
                        .col-md-6.mb-3  
                            label(for='voltage') Company Name
                            input.form-control(type='text' name='compname' placeholder=company.compname value='')
                        .col-md-6.mb-3  
                          label(for='voltage') Address
                          input.form-control(type='text' name='compaddress' placeholder=company.address value='')
                      .row
                        .col-md-6.mb-3
                          label.form-label(for='download') Upload Scanned Sales Invoice
                          input#uploadselect.form-control-plaintext(type='file' name='uploadedSI' value='Upload' required) 
                      .row
                        .col-md-6.mb-3  
                          label(for='voltage') Start Date
                          input.form-control(type='date' name='startdate' placeholder='' required='')
                        .col-md-6.mb-3  
                          label(for='voltage') Finish Date
                          input.form-control(type='date' name='finishdate' placeholder='' required='')
                        
    include ../components/stage_footer.pug
    script(src='../js/common.js')
    script. 
        - $(document).ready(function() {
            const tagID = !{JSON.stringify(tagID)};
            const draft = !{JSON.stringify(draft)};
            var baseurl = window.location.protocol + "//" + window.location.host + "/";
            $.ajax({   
                async: true,  
                method: 'GET',
                url: baseurl+'motor/rewinder/'+tagID,                        
                success: function (data) {                        
                    tmp = data;
                    $('.rewinders').val(data[0].rewindername)
                },
                error: function (xhr, text, error) {              
                    alert('Error: ' + error);
                }
            })


            $('input[name="genSI"]').on('click', function(){   
                $("#submit").prop('disabled', false);
                var grandparent = $(this).parent().parent();
                grandparent.find('.genSI').remove();
                $('.genSI').remove()
                $.ajax({   
                  async: true, 
                  method: 'POST',
                  data:  $('form').serialize(),   
                  url: baseurl+'io/asset/forbillingstatement/si/notexists/'+tagID,                          
                  success: function (data) {  
                    grandparent.append('<div class="col-md-6 mb-3 genSI"><label for="voltage">Generated Content</label><div class="gencard card"><div class="card-body"><a target="_blank" href="'+baseurl+'io/asset/forbillingstatement/si/notexists/'+tagID+'">Click here</a></div></div></div>');
                  },
                  error: function (xhr, text, error) {              
                    alert('Error: ' + error);
                  }
                })
            })

            -$('#save').click(function(e) {
              $.magnificPopup.open({
                items: {
                  src: '<div class="white-popup">Saving...</div>',
                  type: 'inline'
                }
              });

              $.ajax({   
                  async: true, 
                  method: 'POST',
                  data:  $('form').serialize(),   
                  url: baseurl+'motor/save/forbillingstatement/'+tagID,                          
                  success: function (data) {  
                    $.magnificPopup.close();
                    //Close the popup
                    e.preventDefault();
                    if (window.parent == window.top) {
                        window.parent.$.magnificPopup.close();
                    }
                  },
                  error: function (xhr, text, error) {              
                    alert('Error: ' + error);
                  }
              })
            });

            //MOD

            if(draft)
            {
              $('input[name="sino"]').val(draft[0].sino)
              $('input[name="compname"]').val(draft[0].compname)
              $('input[name="compaddress"]').val(draft[0].compaddress)
            }
        })


     
